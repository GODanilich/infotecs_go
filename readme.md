# RUS Infotecs_go

## Что это?

 Это простое **приложение для обработки транзакций платёжной системы**
в виде **HTTP сервера**, реализующее **REST API** и имеющее три метода:
**POST Send**, **GET GetLast** и **GET GetBalance**.    

>**Данное приложение является тестовым заданием на стажировку**.
## Что было использовано в разработке?

Приложение написано на **Go** версии **1.22.2** с использованием сторонних библиотек, в качестве базы данных используется **PostgreSQL 17**.
 Для миграций таблиц используется [goose](https://github.com/pressly/goose),
  для генерации **sql-кода** используется [sqlc](https://github.com/sqlc-dev/sqlc?tab=readme-ov-file). Генерируемые sqlc запросы строго параметризированны, что практически полностью исключает SQL-инъекции.
 Для создания образов использовался **Docker**  и **Docker Compose** для оркестрации контейнеров.

## Запуск
>При первом запуске приложения создается 10 кошельков со случайными адресами и 100.0 у.е. на счету.

HTTP запросы к приложению можно делать любой удобной утилитой (curl, postman и т.д.)

### Docker-compose
> Запустить приложение вместе с базой данных можно командой:
```bash
docker-compose up --build
 ```
 > В контейнере db-1 можно войти в интерфейс PosgreSQL командой:
```
psql -h localhost -p 5433 -U user -d infotecs
```
> Получить таблицу кошельков для получения адресов кошельков:
```sql
SELECT * FROM wallets;
```
Далее можно пользоваться приложением.
### Нативный запуск
> Необходим клиент PostgreSQL


 ## Методы

* **POST Send** имеет эндпоинт **/api/send**. **Отправляет средства с одного из кошельков на указанный 
кошелек**. Метод принимает в теле запроса **JSON-объект**, содержащий следующие поля:
    * **from** – адрес кошелька, откуда нужно отправить деньги.  
    *Например: cdd750ee-5525-411b-bb7b-be2c23a8b926*
    * **to** – адрес кошелька, куда нужно отправить деньги.  
    *Например: b8169672-d721-465e-a0a0-eebed16c3e42*
    * **amount** – сумма перевода.  
    *Например: 3.50*.

> Возвращает json-объект созданной транзакции:
```json
{
    "id": "d8cf02a6-51d0-4d8d-801b-91a6a573f41c",
    "executed_at": "2025-07-18T05:11:04.459813Z",
    "amount": "10.22",
    "sender_address": "68ea3291-8d2f-4d57-a116-eda6d7466086",
    "recipient_address": "b5e1af31-e333-40e1-a874-0d7c571b110b"
}
```
> Если средств на кошельке недостаточно, то возвращается ошибка в виде json:
```json
{
    "error": "Not enough money: balance is 100, your amount 100.22"
}
```
> Если введенная сумма перевода меньше минимально допустимой, то возврщается ошибка в виде json:
```json
{
    "error": "Amout value is too small: minimum value is 0.01, your amount is 0"
}
```
> Если десятичная часть введенной суммы перевода содержит более 2ух знаков, то возврщается ошибка в виде json:
```json
{
    "error": "Amount can have maximum 2 decimal places, your input has 3 in .234"
}
```
> Поля "from" и "to" не должны совпадать, иначе возврщается ошибка в виде json:
```json
{
    "error": "Sender and recipient addresses can`t be the same"
}
```
***

* **GET GetLast** имеет эндпоинт **/api/transactions?count=N**. **Возвращает информацию о N последних по времени переводах средств**. Метод принимает в query-параметрах число возвращаемых **JSON-объектов** в массиве.
> Пример для N = 2:
```json
[
    {
        "id": "d8cf02a6-51d0-4d8d-801b-91a6a573f41c",
        "executed_at": "2025-07-18T05:11:04.459813Z",
        "amount": "10.22",
        "sender_address": "68ea3291-8d2f-4d57-a116-eda6d7466086",
        "recipient_address": "b5e1af31-e333-40e1-a874-0d7c571b110b"
    },
    {
        "id": "d50035ce-6036-4aed-ade2-fd0c6ff9024c",
        "executed_at": "2025-07-18T03:08:10.620316Z",
        "amount": "1.22",
        "sender_address": "cdd750ee-5525-411b-bb7b-be2c23a8b926",
        "recipient_address": "5ac7fcdb-f373-475c-a402-b7f4bc36a691"
    }
]
```
> Если на момент выполнения запроса не было выполнено ни 1 транзакции, то возвращает null
***

* **GetBalance**, имеет эндпоинт **GET /api/wallet/{address}/balance**. **Возвращает информацию о балансе кошелька в JSON-объекте**. Метод принимаент адрес кошелька в пути запроса.


> Пример вывода в ответе:
```json
{
    "balance": "102.23"
}
```